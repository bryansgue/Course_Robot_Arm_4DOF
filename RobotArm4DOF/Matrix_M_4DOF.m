function M = Matrix_M_4DOF(m1,m2,m3,m4,I1,I2,I3,I4,l1,l2,l3,l4,q1,q2,q3,q4)

M = [I1 + I2 + I3 + I4 + (l2^2*m2)/2 + (l2^2*m3)/2 + (l2^2*m4)/2 + (l3^2*m3)/2 + (l3^2*m4)/2 + (l4^2*m4)/2 + (l2^2*m2*cos(2*q2))/2 + (l2^2*m3*cos(2*q2))/2 + (l2^2*m4*cos(2*q2))/2 + (l4^2*m4*cos(2*q2 + 2*q3 + 2*q4))/2 + (l3^2*m3*cos(2*q2 + 2*q3))/2 + (l3^2*m4*cos(2*q2 + 2*q3))/2 + l2*l4*m4*cos(2*q2 + q3 + q4) + l2*l4*m4*cos(q3 + q4) + l2*l3*m3*cos(q3) + l2*l3*m4*cos(q3) + l3*l4*m4*cos(q4) + l3*l4*m4*cos(2*q2 + 2*q3 + q4) + l2*l3*m3*cos(2*q2 + q3) + l2*l3*m4*cos(2*q2 + q3),                                                                                                                                                                 0,                                                                                                                        0,                                                       0;...
    0, I2 + I3 + I4 + l2^2*m2 + l2^2*m3 + l2^2*m4 + l3^2*m3 + l3^2*m4 + l4^2*m4 + 2*l2*l4*m4*cos(q3 + q4) + 2*l2*l3*m3*cos(q3) + 2*l2*l3*m4*cos(q3) + 2*l3*l4*m4*cos(q4), I3 + I4 + l3^2*m3 + l3^2*m4 + l4^2*m4 + l2*l4*m4*cos(q3 + q4) + l2*l3*m3*cos(q3) + l2*l3*m4*cos(q3) + 2*l3*l4*m4*cos(q4), I4 + l4^2*m4 + l2*l4*m4*cos(q3 + q4) + l3*l4*m4*cos(q4);...
    0,                                          I3 + I4 + l3^2*m3 + l3^2*m4 + l4^2*m4 + l2*l4*m4*cos(q3 + q4) + l2*l3*m3*cos(q3) + l2*l3*m4*cos(q3) + 2*l3*l4*m4*cos(q4),                                                               I3 + I4 + l3^2*m3 + l3^2*m4 + l4^2*m4 + 2*l3*l4*m4*cos(q4),                         m4*l4^2 + l3*m4*cos(q4)*l4 + I4;...
    0,                                                                                                           I4 + l4^2*m4 + l2*l4*m4*cos(q3 + q4) + l3*l4*m4*cos(q4),                                                                                          m4*l4^2 + l3*m4*cos(q4)*l4 + I4,                                            m4*l4^2 + I4];

end
